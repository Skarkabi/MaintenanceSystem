<form action="" method="" id="displayMainForm">
<div class="col-md-12">
    {{!-- Action Buttons --}}
    <div class="header-action-buttons pull-right">
        <button class="btn btn-primary" id="materialReques-update" disabled="" onclick='setAction(event, "update", "{{existingMain.req}}")'><i class="fas fa-edit"></i>Update</button>
        <button class="btn btn-success" id="confirmUpdate" onclick='setAction(event, "complete", "{{existingMain.req}}")' data-confirm="Confirm This Job is Completed?"><i class="fas fa-check"></i>Complete</button>
        {{#if user.admin}}
        <a href="/vehicles/delete/{{existingVehicle.plate}}/{{existingVehicle.chassis}}" role="button" class="btn btn-danger delete" id="delete" class="delete" data-confirm="Are you sure to delete {{existingVehicle.brand}} {{existingVehicle.model}} With Plate # {{existingVehicle.plate}}?"><i class="fas fa-trash" aria-hidden="true"></i> Delete</a>
       
        {{/if}}
        {{#if showPii}}
        <a href="/users/update/{{existingUser._id}}" role="button" class="btn btn-outline-dark" id="update"><i class="far fa-edit" aria-hidden="true"></i> Update</a>
        {{/if}}
    </div>
    <body onload="setTable('material');">
        <div class="section-wrapper">
            <div class="section-title">
                <div class="row">
                    <div class="col">
                        <h4><i class="fas fa-tools"></i>&nbsp;Job Details</h4>
                    </div>
                    <div class="col"  style="font-weight:bold;">
                        <div class="row">
                            <h4>Status:&nbsp; </h4>
                            {{#if (isdefined existingMain.status "Not Started")}}
                                <h4 style="color:red; font-weight:bold">&nbsp;NOT STARTED</h4>
                                {{/if}}
                            {{#if (isdefined existingMain.status "In Progress")}}
                                <h4 style="color:#0000FF; font-weight:bold">&nbsp;IN PROGRESS</h4>
                            {{/if}}
                            {{#if (isdefined existingMain.status "Pending Material")}}
                                <h4 style="color:#FD7F20; font-weight:bold">&nbsp;PENDING MATERIAL</h4>
                            {{/if}}
                            {{#if (isdefined existingMain.status "Completed")}}
                                <h4 style="color:#00D100; font-weight:bold">&nbsp;COMPLETED</h4>
                            {{/if}}
                        </div>
                    </div>
                </div>
                <hr class="my-3">
            </div>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group col display-main">
                        <label for="dateCreated">Date Created</label>
                        <input type="text" class="form-control" name="dateCreated" brand="dateCreated" value="{{existingMain.createdAt}}" readonly>
                    </div>
                    <div class="form-group col display-main">
                        <label for="dateCreated">Material Request #</label>
                        <input type="checkbox" class="btn-check" id="materialRequest-checkbox" autocomplete="off" onchange="unlockInput('materialRequest')">
                        <input type="text" class="form-control" id="materialRequest" name="materialRequest" brand="materialRequest" disabled="" value="{{existingMain.material_request}}">
                    </div>
                    <div class="form-group col display-main">
                        <label for="division">Divison</label>
                        <input type="text" class="form-control" name="division" brand="division" value="{{existingMain.division}}" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col display-main">
                        <label for="plate">Plate #</label>
                        <input type="text" class="form-control" name="plate" brand="plate" value="{{existingMain.plate}}" readonly>
                    </div>
                    <div class="form-group col display-main">
                        <label for="category">Vehicle Category</label>
                        <input type="text" class="form-control" name="category" brand="category" value="{{existingMain.vehicle_data.category}}" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col display-main">
                        <label for="brand">Vehicle Brand</label>
                        <input type="text" class="form-control" name="brand" brand="brand" value="{{existingMain.vehicle_data.brand}}" readonly>
                    </div>
                    <div class="form-group col display-main">
                        <label for="model">Vehicle Model</label>
                        <input type="text" class="form-control" name="model" brand="model" value="{{existingMain.vehicle_data.model}}" readonly>
                    </div>
                    <div class="form-group col display-main">
                        <label for="year">Vehicle Year</label>
                        <input type="text" class="form-control" name="year" brand="year" value="{{existingMain.vehicle_data.year}}" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col display-main">
                        <label for="hourC">Cost Per Hour</label>
                        <input type="text" class="form-control" name="hourC" brand="hourC" value="{{existingMain.hour_cost}} AED" readonly>
                    </div>
                    <div class="form-group col display-main">
                        <label for="materialCost">Material Cost</label>
                        <input type="text" class="form-control" name="materialCost" brand="materialCost" value="{{existingMain.materialCost}} AED" readonly>
                    </div>
                    <div class="form-group col display-main">
                        <label for="totalCost">Total Cost</label>
                        <input type="text" class="form-control" name="totalCost" brand="totalCost" value="{{existingMain.total_cost}} AED" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col display-main">
                        <label for="discription">Discription</label>
                        <input type="checkbox" class="btn-check" id="discription-checkbox" autocomplete="off" onchange="unlockInput('discription')">
                        <textarea type="text" class="form-control" id="discription" name="discription" brand="discription" disabled="" value="{{existingMain.discription}}">{{existingMain.discription}}</textarea>
                    </div>
                    <div class="form-group col display-main">
                        <label for="remark">Remarks</label>
                        <input type="checkbox" class="btn-check" id="remark-checkbox" autocomplete="off" onchange="unlockInput('remark')">
                        <textarea type="text" class="form-control" id="remark" name="remark" brand="remark" disabled="" value="{{existingMain.remarks}}">{{existingMain.remarks}}</textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-wrapper">
            <div class="section-title">
                <div class="row">
                    <h4 class="col" style="font-weight:bold" onclick="setTable('material')"><a onmouseover="style='cursor:pointer; color:#2779F6'" onmouseout="style='color:black'"><i class="fas fa-gas-pump"></i>Materials Used</a></h4>  
                    <h4 class="col" style="font-weight:bold" onclick="setTable('employee')"><a onmouseover="style='cursor:pointer; color:#2779F6'" onmouseout="style='color:black'"><i class="fas fa-users"></i>Assigned Employees</a></h4>
                </div>
                <hr class="my-3">
            </div>
            <div class="section-content" id="tableSection">
            </div>
        </div>
    </body>
</div>
</form>


<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>  
<script>
    function setTable(tableName, tableData){
        document.getElementById("tableSection").innerHTML = "";
        if(tableName === "material"){
            document.getElementById("tableSection").insertAdjacentHTML("afterbegin", `{{>mainMaterialTable}}`);

        }else if(tableName === "employee"){
            document.getElementById("tableSection").insertAdjacentHTML("afterbegin", `{{>mainEmployeeTable}}`);

        }
        
    }

    function changeColor(elementId){
        document.getElementById(elementId).style = "color:blue";
    }
    
    function test(){
        // Get the modal
        var modal = document.getElementById("myModal");
        var mContent = document.getElementById("mContent")
        // Get the button that opens the modal
        var btn = document.getElementById("create-new");
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        // When the user clicks on the button, open the modal
        btn.onclick = function() {
            modal.style.display = "block";
            mContent.insertAdjacentHTML("beforeend",`{{>mainConsumables}}`);
        }
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
            mContent.innerHTML='';
        }
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                mContent.innerHTML='';
            }
        }
    }
    

    function changeToNull(){
        document.getElementById("category").value = "";
    }
    function setPage(){
        var category = document.getElementById("category");
        var stock = document.getElementById("stock");
        document.getElementById("addSection").innerHTML = "";
        console.log(category);
        if(stock.value === "new"){
            if(category.value === "battery"){
                console.log("This");
                document.getElementById("addSection").insertAdjacentHTML("afterbegin",`{{>addBatteries}}`);

            }else if(category.value === "brake"){
                document.getElementById("addSection").insertAdjacentHTML("afterbegin",`{{>addBrakes}}`);

            }else if(category.value === "filter"){
                document.getElementById("addSection").insertAdjacentHTML("afterbegin",`{{>addFilters}}`);
             
            }else if(category.value === "grease"){
                document.getElementById("addSection").insertAdjacentHTML("afterbegin",`{{>addGrease}}`);
             
            }else if(category.value === "oil"){
                document.getElementById("addSection").insertAdjacentHTML("afterbegin",`{{>addOil}}`);
             
            }
        }else if(stock.value === "stock"){
           if(category.value === "battery"){
               document.getElementById("addSection").insertAdjacentHTML("afterbegin",`{{>jobBatteries}}`);
           }
        }
        
    }

    function unlockInput(selectedInput){
        console.log(document.getElementById("displayMainForm").action);
        if(document.getElementById(`${selectedInput}-checkbox`).checked){
            document.getElementById(`${selectedInput}`).removeAttribute("disabled");
            document.getElementById("materialReques-update").removeAttribute("disabled");;
        }else{
            document.getElementById(`${selectedInput}`).setAttribute("disabled", "true");
            document.getElementById("materialReques-update").setAttribute("disabled", "true");
        }
        
    }

    function setAction(event, buttonAction, reqNumber){
        if(buttonAction === "update"){
            document.getElementById("displayMainForm").action = `/maintanence/update/material_request/${reqNumber}`
            document.getElementById("displayMainForm").method = `POST`
        }else if(buttonAction === "complete"){
            if(confirm("Confirm This Job is Completed?")){
                document.getElementById("displayMainForm").action = `/maintanence/update/${reqNumber}`
                document.getElementById("displayMainForm").method = `POST`
                document.getElementById("displayMainForm").submit();
            }else{
                event.preventDefault();
                document.getElementById("displayMainForm").method = `GET`
                
            }
            
        }
    }

    function testter(){
        
    }
</script>